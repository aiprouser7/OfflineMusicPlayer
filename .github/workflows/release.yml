name: Release APK

on:
  push:
      tags:
            - 'v*'

            jobs:
              build-and-release:
                  runs-on: ubuntu-latest

                          steps:
                              - name: Checkout code
                                    uses: actions/checkout@v3

                                              - name: Setup Java JDK 17
                                                    uses: actions/setup-java@v3
                                                          with:
                                                                  java-version: '17'
                                                                          distribution: 'temurin'
                                                                                  cache: gradle

                                                                                              - name: Grant execute permission to gradlew
                                                                                                    run: chmod +x gradlew
                                                                                                          
                                                                                                              - name: Build release APK
                                                                                                                    run: ./gradlew assembleRelease --stacktrace
                                                                                                                          
                                                                                                                              - name: Create GitHub Release
                                                                                                                                    id: create_release
                                                                                                                                          uses: actions/create-release@v1
                                                                                                                                                env:
                                                                                                                                                        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
                                                                                                                                                              with:
                                                                                                                                                                      tag_name: ${{ github.ref }}
                                                                                                                                                                              release_name: Release ${{ github.ref_name }}
                                                                                                                                                                                      body: |
                                                                                                                                                                                                ## Offline Music Player Release ${{ github.ref_name }}
                                                                                                                                                                                                          
                                                                                                                                                                                                                    ### Download
                                                                                                                                                                                                                              - **APK**: [Download Here](https://github.com/${{ github.repository }}/releases/download/${{ github.ref_name }}/app-release.apk)
                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                  ### What's New
                                                                                                                                                                                                                                                            - Offline music playback
                                                                                                                                                                                                                                                                      - Beautiful Material Design UI
                                                                                                                                                                                                                                                                                - Playlist management
                                                                                                                                                                                                                                                                                          - Interactive features
                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                              ### Installation
                                                                                                                                                                                                                                                                                                                        1. Download the APK file
                                                                                                                                                                                                                                                                                                                                  2. Enable installation from unknown sources (if needed)
                                                                                                                                                                                                                                                                                                                                            3. Run: `adb install app-release.apk`
                                                                                                                                                                                                                                                                                                                                                      4. Or tap the APK file on your device
                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                          ### Requirements
                                                                                                                                                                                                                                                                                                                                                                                    - Android 5.0 (API 21) or higher
                                                                                                                                                                                                                                                                                                                                                                                              - Minimum 50MB free storage
                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                draft: false
                                                                                                                                                                                                                                                                                                                                                                                                                        prerelease: false
                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                    - name: Upload APK to Release
                                                                                                                                                                                                                                                                                                                                                                                                                                          uses: actions/upload-release-asset@v1
                                                                                                                                                                                                                                                                                                                                                                                                                                                env:
                                                                                                                                                                                                                                                                                                                                                                                                                                                        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                              with:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                      upload_url: ${{ steps.create_release.outputs.upload_url }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                              asset_path: ./app/build/outputs/apk/release/app-release.apk
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      asset_name: app-release.apk
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              asset_content_type: application/vnd.android.package-archive
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          - name: Create release artifact
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                run: |
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        mkdir -p release_artifacts
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cp app/build/outputs/apk/release/app-release.apk release_artifacts/
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            - name: Upload artifacts
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  uses: actions/upload-artifact@v3
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        with:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                name: release-apk
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        path: release_artifacts/
